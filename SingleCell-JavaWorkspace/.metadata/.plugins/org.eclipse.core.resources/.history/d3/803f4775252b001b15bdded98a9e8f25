package single_cell;

import org.apache.jena.query.*;

public class QueryTest {

	private static void executeQuery(String NS, MyModel model, String queryStringTest7) {
		Query query = QueryFactory.create(queryStringTest7);
		try (QueryExecution qexec = QueryExecutionFactory.create(query, model.getModel())) {
			ResultSet results = qexec.execSelect();
			int i = 0;
			for (; results.hasNext();i++) {
				QuerySolution soln = results.nextSolution();
				
				System.out.println(soln.toString().replaceAll(NS, ""));
			}
			// System.out.println(i + " results.");
		}
	}
	
	public static void main(String[] args) {
		String inputFileName = "../../SingleCell-Files/out_repositoriev4.owl";

		String NS = "http://www.semanticweb.org/alicia/ontologies/2020/8/singleCellRepositories#";
		String rdf = "http://www.w3.org/1999/02/22-rdf-syntax-ns#";
		String xsd = "http://www.w3.org/2001/XMLSchema#";
		
		MyModel model = new MyModel(NS, inputFileName);

		String query = "PREFIX a: <" + NS + "> " +
				"PREFIX rdf: <" + rdf + "> " +
				"PREFIX xsd: <" + xsd + "> " +
				"SELECT ?project ?donors \n" +
				"WHERE" +
				"{" +
					"?id rdf:type a:Project ;" +
					"    a:SPR.hasProjectTitle a:project ;" +
					"    a:PR.hasDonorCount ?donors ." +
				"}" +
				"GROUP BY ?project \n" +
				//"ORDER BY DESC(?numberOfDonors) \n" +
				"LIMIT 1";
		
		// Execute query
		executeQuery(NS, model, query);
		
		
	}
}
